#!/bin/bash
# copies password ONLY ONCE to primary selection and username to secondary.

# to make sure lpass copies the password only once.
#export LPASS_CLIPBOARD_COMMAND="xclip -selection clipboard -in -l 2"

selection=`lpass ls --long | grep -v '.*\/\s' | grep -v 'Generated' | cut -d ' ' -f 3- | sed 's/\[username: /[/' | sed 's/\(.*\)\(\[.*\]\) \(\[.*\]\)/\1 \3 \2/'  | awk 'NF{NF-=2};1' | dmenu -l 7 -p 'choose password:'`

echo $selection &&

if [ "$selection" != "" ]; then
    lpass show -c --password $selection &
    lpass show --username $selection | xclip &&
    notify-send -t 2000 "lastmenu:" "copied."
fi
