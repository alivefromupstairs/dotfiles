#!/usr/bin/bash

torrentflix="$@"
peerflixsubs="--subtitles=/tmp/sub.srt"

magnet="$(echo $torrentflix | awk -F" " -v quote="'" -v OFS="' '" '$1=$1 {print quote $1 quote}')" # remove anything but the torrentflix link and add quotes around it

#echo -n mpv "$subs$magnet" | xclip

hashdir="$(echo $magnet | md5sum | cut -d ' ' -f 1)"
directory="/tmp/film/$hashdir"

if [ ! -d "$directory" ]; then
  mkdir -p "$directory/torrent"

  echo "

  "
  echo -n btfs "$magnet" "$directory/torrent" && cd "$directory/torrent" | xclip

  if test "${torrentflix#*$peerflixsubs}" != "$torrentflix" # test if torrentflix includes peerflixsubs string
  then
#    subs='--sub-file=/tmp/sub.srt ' # if yes, populate this var
    cp -f /tmp/sub.srt $directory
#  else
#    subs='' # if no, populate it with nothing
  fi
fi

